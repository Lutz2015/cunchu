define(function(require,exports,module){function a(){var a=new $.Deferred;return h.get({url:j.getUserCarList,success:function(b){a.resolve(b.result)}}),a}function b(a){var b=new $.Deferred;return h.get({url:j.checkCarSchemeState,data:a,success:function(a){b.resolve(a.result)}}),b}function c(a){$(a).on("click",function(a){var c=$(this),d=c.data("cid"),e=c.data("bid"),f=c.data("sid"),g={cid:d,bid:e,sid:f},i=b(g);i.then(function(a){if(0==a.onecarwithscheme)return h.showError("您选择的车辆不在该直达号保养范围内"),!1;var b=c.find(".c-user-car-name").text(),g=c.data("uccode"),i=c.data("logo"),j=c.data("ucid"),k=c.data("skm"),l=c.data("dkm"),m={cid:d,bid:e,sid:f,cname:b,uccode:g,logo:i,ucid:j,skm:k,dkm:l},n=h.getLocalData("otherInfo");if(n.currentCar=m,a.spnum>1)h.setLocalData("otherInfo",n),location.href="#shop/";else if(1==a.spnum){var o={sp_no:a.spno,sp_address:a.spaddress,sp_name:a.spname};n.currentShop=o,h.setLocalData("otherInfo",n),location.href="#services/"}})})}function d(){$(".j-add-user-car").on("click",function(a){h.setLocalData("hasOldCar",!1),h.setLocalData("isFromMyCar",!1),h.setLocalData("changeOldCar",!1),location.href="#carselect/"}),$(".j-user-car-login").on("click",function(a){var b=location.href;h.appointLogin(b)})}function e(){i.render("template/car",{},function(b,e){k.html(e),d();var f=a();f.then(function(a){a&&a.length>0?i.render("template/usercarlist",{result:a,carLogo:carLogo,showTitle:!0},function(a,b){$(".j-user-car-list").html(b),c(".j-user-car")}):h.getLocalData("isFromNav")&&(h.setLocalData("isFromNav",!1),location.href="#carselect/")})})}function f(){if(h.isBox)return document.title="选择车辆",!1;var a=require("widget/head/js/head");a.init({hasBack:1,hasHref:"http://www.baidu.com",title:"选择车辆",dom:"#carhead",loginout:0})}function g(){f(),e(),h.toggleContent("#car")}require("template/car"),require("template/usercarlist");var h=window.sharp,i=window.dust,j=window.sharpApi,k=$("#carcontent");module.exports={init:g}});