define(function(require,exports,module){require("template/orderList"),require("template/detailpay");var a,b=require("widget/tips/js/tips"),c=require("widget/dialog/js/dialog"),d=window.sharp,e=window.dust,f=window.sharpApi,g=$("#orderdetailcontent"),h={_bindEvent:function(){$(".j-orderrefund").on("click",function(){c.init({hasCancel:!0,hasHead:!0,title:"申请退款",confirm:"确定",content:'<div class="c-order-dialog-refund">确认退款吗？</div>',dom:"#orderlist",callback:function(){$(".j-dialog").remove(),$(".w-mask").addClass("hide"),$.ajax({type:"POST",url:f.orderRefund,data:{oid:a,appid:appid},dataType:"json",success:function(a){1==a.error?b.init({time:1e3,content:a.message,type:2}):b.init({time:1e3,content:"已成功发起退款，请稍候刷新",type:2})},error:function(a,b){}})}})})},getOrderData:function(){d.get({url:f.getOrderList,data:{oid:a,appid:appid},success:function(a){a.result.carLogo=window.carLogo,a.result.payurl=window.payurl,e.render("template/orderList",a.result,function(b,c){function e(){var b=a.result.goods_desc,c=b.split("#")[0],d=b.split("#")[1],e=new RegExp("\\(","g"),f=new RegExp("\\)","g"),g=new RegExp("\\/","g");c=c.replace(e,"<tr><td>"),c=c.replace(g,"</td><td>￥"),c=c.replace(f,"</tr>"),$(".c-order-tbody").html(c),void 0!=d&&""!=d&&" "!=d?(d=d.replace(e,"<tr><td>"),d=d.replace(g,"</td><td>￥"),d=d.replace(f,"</tr>"),$(".c-order-tbody2").html(d)):($(".c-order-check-infos").hide(),$(".c-order-table2").hide())}if(0==a.islogin){var f=location.href;d.appointLogin(f)}else{0==a.result.status?$("#orderdetailcontent").css({bottom:"50px"}):1==a.result.status?$("#orderdetailcontent").css({bottom:"50px"}):""==a.result.ecode&&$("#orderdetailcontent").css({bottom:"0"}),$("#orderdetailcontent").html(c);try{e()}catch(g){console.log(g)}}}),e.render("template/detailpay",a.result,function(b,c){$("#orderdetailfoot").html(c),/pos/.test(a.result.order_no)?$("#orderdetailfoot").addClass("hide"):$("#orderdetailfoot").removeClass("hide"),(4==a.result.status||""==a.result.ecode)&&($("#orderdetailfoot").addClass("hide"),$("#orderdetailcontent").css({bottom:"0"})),2==a.result.status&&$("#orderdetailcontent").css({bottom:"50px"}),5==a.result.status&&($("#orderdetailfoot").addClass("hide"),$("#orderdetailcontent").css({bottom:"0"})),1==a.result.status&&""==a.result.ecode&&$("#orderdetailcontent").css({bottom:"50px"})}),h._bindEvent()},error:function(){}})},_init:function(b){if(!g.html())if(d.isBox)document.title="订单详情";else{var c=require("widget/head/js/head");c.init({dom:"#orderlistdetailhead",hasBack:"1",title:"订单详情"})}a=b,h.getOrderData(),d.toggleContent("#orderlist")}};module.exports={init:h._init}});