define(function(require,exports,module){function a(a){var b=new $.Deferred,c=a.data;return q||(c||(c={}),c.aid=appid),o.get({url:a.url,data:c,success:function(a){b.resolve(a.result)}}),b}function b(b){return a({url:sharpApi.getSeriesList,data:{bid:b}})}function c(){for(var a=0;a<r.length;a++){var b=r[a];s[b]=a,t[a]={key:b,top:Number($(".j-car-word-"+b).offset().top)-p}}}function d(){var b=a({url:sharpApi.getBrandList}),c=new $.Deferred;return b.then(function(a){var b=a.length;r=[];for(var d=0;b>d;d++)r.push(a[d].key);c.resolve(a)}),c}function e(b){return a({url:sharpApi.getCarList,data:{sid:b}})}function f(a){1===a.type?k(a):2===a.type?i(a):3===a.type&&g(a)}function g(a){var b=$(a.dom);if(o.carModels)require("widget/car/html/model"),n.render("widget/car/html/model",{result:o.carModels},function(a,c){b.html(c),h()});else{var c=o.getLocalData("otherInfo");if(o.getLocalData("changeOldCar"))var d=c.newCar.sid;else var d=c.currentCar.sid;var f=e(d);f.then(function(a){require("widget/car/html/model"),n.render("widget/car/html/model",{result:a},function(a,c){b.html(c),h()})})}}function h(){$(".j-car-model").on("click",function(a){var b=$(this),c=o.getLocalData("otherInfo");if(o.getLocalData("changeOldCar")){var d=c.newCar;o.setLocalData("changeOldCar",2)}else var d=c.currentCar;d.cid=b.data("id"),d.ccode=b.data("ccode"),d.cname=b.data("name"),d.dkm=b.data("dkm"),d.skm=b.data("skm"),o.setLocalData("otherInfo",c),location.href="#addcar/"})}function i(a){var c=$(a.dom);if(o.carSeries)require("widget/car/html/series"),n.render("widget/car/html/series",{result:o.carSeries},function(a,b){c.html(b),j()});else{var d=o.getLocalData("otherInfo");if(o.getLocalData("changeOldCar"))var e=d.newCar.bid;else var e=d.currentCar.bid;var f=b(e);f.then(function(a){require("widget/car/html/series"),n.render("widget/car/html/series",{result:a},function(a,b){c.html(b),j()})})}}function j(){$(".j-car-series").on("click",function(a){var b=$(this),c=o.getLocalData("otherInfo");if(o.getLocalData("changeOldCar"))var d=c.newCar;else var d=c.currentCar;var f=b.data("id");d.sid=f,d.sname=b.data("name"),o.setLocalData("otherInfo",c);var g=e(f);g.then(function(a){0==a.length?o.showError("暂无数据"):(o.carModels=a,location.href="#modelselect/")})})}function k(a){q?$(".c-car-nav").removeClass("hide"):$(".c-car-nav").addClass("hide");var b=$(a.dom),e=d();e.then(function(d){d.length>0&&($(".j-car-word-suspend").text(d[0].key),require("widget/car/html/brand"),n.render("widget/car/html/brand",{result:d,carLogo:carLogo},function(d,e){b.html(e),l(a),setTimeout(function(){c()},300)}))})}function l(a){function c(){var a=d.scrollTop(),b=t[e],c=t[e+1],f=t[e-1],g=$(".c-car-word-suspend");c&&(a>=c.top-22&&a<c.top?g.css("top",p-(a+22-c.top)):a>=c.top?(g.text(c.key),g.css("top",p),e++):a>b.top&&(g.text(b.key),g.css("top",p))),f&&(a<=b.top-40?(g.text(f.key),g.css("top",p),e--):a<=b.top&&a>=b.top-22&&(g.text(f.key),g.css("top",p-(a+22-b.top))))}if($(".j-car-brand").on("click",function(a){var c=$(this),d=c.data("id"),e={bid:d,logo:c.data("logo"),bname:c.data("name")},f=o.getLocalData("otherInfo");o.getLocalData("changeOldCar")?f.newCar=e:f.currentCar=e,o.setLocalData("otherInfo",f);var g=b(d);g.then(function(a){0==a.length?o.showError("暂无数据"):(o.carSeries=a,location.href="#seriesselect/")})}),!q)return!1;var d=$(a.dom),e=0;d.on("scroll",c),d.on("touchmove",c);var f;$(".j-car-nav-word").on("click",function(){f&&clearTimeout(f);var a=$(this).html(),b=t[s[a]].top,c=d.scrollTop();if(b!=c){var e=function(a,b,c,d){return c*((a=a/d-1)*Math.pow(a,10)+1)+b},g=0,h=b-c,i=40,j=function(){i>g?(g++,d.scrollTop(Math.ceil(e(g,c,h,i))),f=setTimeout(j,25)):d.scrollTop(b)};j()}})}function m(a){q=o.getLocalData("isFromMyCar"),f(a)}var n=window.dust,o=window.sharp;if(o.isBox)var p=0;else var p=45;var q,r=[],s={},t=window.carWordsOffsetTops=[];module.exports={init:m}});