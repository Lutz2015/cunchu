define(function(require,exports,module){function a(){sharp.showLoading(".j-content"),b()}function b(){var a={};m().then(function(b){return a=b,n()}).then(function(b){for(var c=a.result,d=b.result,e=0;e<c.length;e++)for(var f=c[e],g=0;g<d.length;g++){var h=d[g];if(h.key===f.key)for(var j=f.cars,k=h.cars,m=0;m<j.length;m++){for(var n=j[m],p=0;p<k.length;p++){var q=k[p];q.sid===n.sid&&(q.checked=!0)}x.push({sid:n.sid,name:f.key+n.sname,hasPrice:!0})}}dust.render("template/home",{brand:u,series:d},function(a,b){$(".j-content").html(b),l(),o(),i()})})}function c(){for(var a=[],b=(y+1)*s,c=y*s;b>c&&x[c];c++)a.push(x[c]);var e={result:a};x.length>(y+1)*s&&(e.showRight=!0),y>0&&(e.showLeft=!0),dust.render("template/seriesmenulist",e,function(a,b){$(".j-series-menu").html(b),d()})}function d(){$(".j-s-menu-goleft").on("click",function(a){a.stopPropagation(),y--,i()}),$(".j-s-menu-goright").on("click",function(a){a.stopPropagation(),y++,i()}),$(".j-s-menu-item").on("click",function(a){a.stopPropagation();var b=$(this);if(b.hasClass("checked"))return!1;$(".j-s-menu-item.checked").removeClass("checked"),b.addClass("checked");var c=b.data("sid");g(c),h()}),$(".j-s-menu-item .iclose").on("click",function(a){a.stopPropagation(),j({sid:this.parentElement.dataset.sid},!1)})}function e(a){var b=B[a],c=new $.Deferred;return b?(A=b.maxNum,c.resolve(b)):sharp.get({url:sharpApi.getmaintaincarlist,data:{bid:u.bid,sid:a},beforeSend:function(a){sharp.showLoading(".j-series-table")},success:function(b){A=b.maxNum=Math.ceil(b.result.length/t),B[a]=b,c.resolve(b)}}),c}function f(a){$(".j-s-price-create").on("click",function(a){a.stopPropagation();var b=a.target.parentElement,c=b.dataset.cname,d=b.dataset.cid,e=require("widget/dialog/js/dialog");e.init({type:0,title:c,cid:d})}),$(".j-s-price-read").on("click",function(a){a.stopPropagation(),window.open(sharpApi.downloadcarsolutionprice+"?cid="+a.target.parentElement.dataset.cid+"&appid="+v)}),$(".j-s-price-update").on("click",function(a){a.stopPropagation();var b=a.target.parentElement,c=b.dataset.cname,d=b.dataset.cid,e=require("widget/dialog/js/dialog");e.init({type:1,title:c,cid:d})}),$(".j-s-price-delete").on("click",function(b){b.stopPropagation();var c=b.target.parentElement.dataset.cid,d=require("widget/popup/js/popupBox");d.init({text:"确定删除该条价格配置",confirm:function(){sharp.post({url:sharpApi.deletecarsolutionprice,data:{appid:v,cid:c},success:function(b){if(0===b.error){for(var d=B[a].result,e=z*t,f=(z-1)*t;e>f;f++){var h=d[f];if(h.cid!==c)break;h.hasPrice=0}g()}else console.log(b.message)}})},cancel:function(){}})})}function g(a){"undefined"==typeof a&&(a=x[y*s].sid),e(a).then(function(b){var c={result:[]},d=b.result;if(0===d.length)c.isEmpty=!0;else for(var e=z*t,g=(z-1)*t;e>g;g++){var h=d[g];if(!h)break;h.cengine=p[h.cengine]||h.cengine,h.cdriving=q[h.cdriving]||h.cdriving,h.cgearbox=r[h.cgearbox]||h.cgearbox,c.result.push(h)}c.result.length<t&&(c.colspan=7,c.rowspan=t-c.result.length,c.trHeight=41*c.rowspan-1),dust.render("template/table",c,function(b,c){$(".j-series-table").html(c),f(a)})})}function h(){0===A?$(".j-series-pagebtn").addClass("hide"):$(".j-series-pagebtn").removeClass("hide");var a=require("widget/pagebtn/js/pagebtn");a.init({dom:".j-series-pagebtn",currentNum:z,maxNum:A,callback:function(a){z=a,g()}})}function i(){z=1,c(),g(),h()}function j(a,b,c){if(b)x.push(a),k(a,b),sharp.post({url:sharpApi.addserieslistbyappid,data:{type:1,sid:a.sid,appid:v}});else{var d=require("widget/popup/js/popupBox");d.init({text:"确认删除整个车系的数据？",confirm:function(){for(var c=0;c<x.length;c++){var d=x[c];if(d.sid===a.sid){sharp.post({url:sharpApi.deletecarsolutionprice,data:{appid:v,sid:a.sid},success:function(b){0===b.error?sharp.post({url:sharpApi.delserieslistbyappid,data:{type:1,sid:a.sid,appid:v},success:function(a){0!==a.error&&console.log(a.message)}}):console.log(b.message)}}),x.splice(c,1);break}}k(a,b)},cancel:function(){c&&(w=!0,$("#ser-"+a.sid).trigger("click"))}})}}function k(a,b){o();var c=$("#ser-"+a.sid);b?c.attr("checked","checked"):c.attr("checked",!1),i()}function l(){var a=$(".j-cur-seri-box"),b=$(".j-cur-ser-unfold"),c=b.find(".j-cur-ser-unfold-text");b.on("click",function(d){d.stopPropagation(),a.hasClass("t-unfold")?(c.html("展开全部"),b.find(".iup").removeClass("iup").addClass("idown")):(c.html("收起"),b.find(".idown").removeClass("idown").addClass("iup")),a.toggleClass("t-unfold")}),a.on("click",function(a){var b=a.target;"iclose"===b.className&&(a.stopPropagation(),j({sid:b.dataset.sid},!1))});var d=$(".j-series-box");d.on("click",function(a){a.stopPropagation()});var e=$(".j-series-btn"),f=e.find(".idown");e.on("click",function(a){a.stopPropagation(),d.toggleClass("hide"),f.toggleClass("idown").toggleClass("iup")}),$(".j-content").on("click",function(a){a.stopPropagation(),f.hasClass("iup")&&(d.toggleClass("hide"),f.toggleClass("idown").toggleClass("iup"))}),d.find("input").on("change",function(a){if(a.stopPropagation(),w)return w=!1,!1;var b=a.target,c={sid:b.value,name:b.dataset.name};j(c,b.checked,!0)})}function m(){return sharp.get({url:sharpApi.getserieslistbyappid,data:{bid:u.bid}})}function n(){return sharp.get({url:sharpApi.getSeriesList,data:{bid:u.bid}})}function o(){0===x.length?$(".j-current-series").addClass("hide"):dust.render("template/seriesbtnlist",{currentSeries:x},function(a,b){$(".j-cur-seri-box").html(b),$(".j-current-series").removeClass("hide"),x.length>s?$(".j-cur-ser-unfold").removeClass("hide"):$(".j-cur-ser-unfold").addClass("hide")})}require("template/home"),require("template/table"),require("template/seriesbtnlist"),require("template/seriesmenulist");var p=["","自然吸气","涡轮增压","机械增压","电动","混动"],q=["","两驱","四驱"],r={MT:"手动",AT:"自动",DCT:"双离合",CVT:"CVT",AMT:"AMT"},s=8,t=10,u=window.brandinfo,v=window.appid,w=!1,x=[],y=0,z=1,A=1,B={};a()});